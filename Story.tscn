[gd_scene load_steps=8 format=2]

[ext_resource path="res://Story.gd" type="Script" id=1]
[ext_resource path="res://graphics/04B_03__.TTF" type="DynamicFontData" id=2]
[ext_resource path="res://graphics/mountain2.png" type="Texture" id=3]

[sub_resource type="DynamicFont" id=1]
size = 20
font_data = ExtResource( 2 )

[sub_resource type="Shader" id=2]
code = "shader_type canvas_item;
render_mode unshaded;

uniform sampler2D sampler;
uniform float brightness : hint_range(0.0, 1.0);
uniform float sampler_offset_y : hint_range(-1.0, 1.0);

void fragment() {
	if(texture(SCREEN_TEXTURE, SCREEN_UV).r == 1.0) {
		COLOR.rgb = mix(texture(sampler, UV * vec2(1.0, 0.5) + vec2(0, sampler_offset_y)).rgb, vec3(0.0, 0.0, 0.0), abs(0.5 - UV.x) + 1.0 - brightness);
	} else {
		COLOR.rgb = vec3(0.0, 0.0, 0.0);
	}
	COLOR.a = 1.0;
}"

[sub_resource type="ShaderMaterial" id=3]
shader = SubResource( 2 )
shader_param/brightness = 0.0
shader_param/sampler_offset_y = 0.7
shader_param/sampler = ExtResource( 3 )

[sub_resource type="Animation" id=4]
resource_name = "story"
length = 65.0
step = 1.0
tracks/0/type = "value"
tracks/0/path = NodePath("ColorRect:material:shader_param/brightness")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 1, 3, 5, 7, 9, 11, 13, 15, 19, 21, 23, 25, 27, 29, 31, 33, 35, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 60, 62, 65 ),
"transitions": PoolRealArray( 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 ),
"update": 0,
"values": [ 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0 ]
}
tracks/1/type = "value"
tracks/1/path = NodePath("ColorRect:material:shader_param/sampler_offset_y")
tracks/1/interp = 2
tracks/1/loop_wrap = true
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/keys = {
"times": PoolRealArray( 0, 65 ),
"transitions": PoolRealArray( 1, 1 ),
"update": 0,
"values": [ 0.7, 0.0 ]
}
tracks/2/type = "value"
tracks/2/path = NodePath("Label:text")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/keys = {
"times": PoolRealArray( 1, 5, 9, 13, 21, 25, 29, 33, 41, 45, 49, 53, 57 ),
"transitions": PoolRealArray( 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 ),
"update": 1,
"values": [ "Once upon a time", "Deep in the tallest peak", "There was a spring with droplets of gold", "Spreading joy and prosperity to all", "Decades later,
on one tragic day", "The wells went dry,
and golden rivers died", "The spring went empty", "And the land was cast into darkness", "Years later, a child
", "Clad in gold and purple, equipped with optimism", "Would dare to end this drought", "Descend into the depths", "And revive the Joyspring" ]
}

[node name="Story" type="Control"]
anchor_right = 1.0
anchor_bottom = 1.0
script = ExtResource( 1 )

[node name="Label" type="Label" parent="."]
anchor_right = 1.0
anchor_bottom = 1.0
custom_fonts/font = SubResource( 1 )
text = "Once upon a time"
align = 1
valign = 1
autowrap = true
clip_text = true

[node name="ColorRect" type="ColorRect" parent="."]
material = SubResource( 3 )
anchor_right = 1.0
anchor_bottom = 1.0
color = Color( 1, 1, 1, 0 )

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
autoplay = "story"
anims/story = SubResource( 4 )
[connection signal="animation_finished" from="AnimationPlayer" to="." method="_on_AnimationPlayer_animation_finished"]
